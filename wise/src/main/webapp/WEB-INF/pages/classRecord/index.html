#@layout_admin() #define js()
<script src="#(ctx)/static/js/jtUtil.js" charset="utf-8"></script>
#end #define main_layout()
<blockquote class="layui-elem-quote layui-quote-nm layui-text"
	style="margin-top: 15px;">
	<div class="jtSearch">
		日期：
		<div class="layui-inline">
			<input class="layui-input" id="data1" autocomplete="off">
		</div>
		<!-- 科目：
		<div class="layui-inline">
			<input class="layui-input" name="keyword" id="keyword"
				autocomplete="off">
		</div> -->
		<button class="layui-btn" data-type="reload">
			<i class="layui-icon">&#xe615;</i> 搜索
		</button>
		<button class="layui-btn" data-type="addData">
			<i class="layui-icon">&#xe608;</i> 新增
		</button>
	</div>
</blockquote>
<!-- table -->
<table id="jtTable" lay-filter="jtTable"></table>

<script type="text/html" id="jtBar">
  <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
</script>

<script>
	layui.use([ 'form', 'table', 'jquery', 'laydate' ], function() {
		var form = layui.form;
		var table = layui.table;
		var laydate = layui.laydate;
		
		laydate.render({
			elem : '#data1' //指定元素
			,format : 'yyyy-MM-dd' //可任意组合
		});
		//第一个实例
		table.render({
			elem : '#jtTable',
			id : 'jtTableReload',
			height : 400,
			cellMinWidth : 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
			,
			url : '#(ctx)/classRecord/pageList1' //数据接口
			,
			page : true //开启分页
			,
			limits : [ 13, 16, 19, 22 ],
			limit : 13,
			response : { //定义后端 json 格式，详细参见官方文档
				statusName : 'code', //状态字段名称
				statusCode : '1', //状态字段成功值
				msgName : 'msg', //消息字段
				countName : 'count', //总数字段
				dataName : 'data' //数据字段
			},
			cols : [ [ //表头
			{
				checkbox : true,
				field : 'id',
				fixed : true,
				width : 50
			}, {
				field : 'cname',
				title : '课程名称',
				align : 'center',
				width : 300
			}, {
				field : 'record_data',
				title : '登记日期',
				align : 'center'
				,templet:'<div>{{ jtUtil.dataFormat(d.start_time,"yyyy-MM-dd")}}</div>'
			}, {
				field : 'start_time',
				title : '开始时间',
				align : 'center'
				,templet:'<div>{{ jtUtil.dataFormat(d.start_time,"hh:mm:ss")}}</div>'
			}, {
				field : 'end_time',
				title : '结束时间',
				align : 'center'
				,templet:'<div>{{ jtUtil.dataFormat(d.start_time,"hh:mm:ss")}}</div>'
			}, {
				field : 'class_hour',
				title : '课时',
				align : 'center'
			}, {
				title : '操作',
				align : 'center',
				toolbar : '#jtBar'
			} ] ]
		});

		
		//监听工具条
		table.on('tool(jtTable)', function(obj) {
			var data = obj.data;
			if (obj.event === 'edit') {
				jtUtil.addRow(table, '登记课时',
						'#(ctx)/classRecord/toForm?id='+data.id,1000,500);
			}
		});

		var $ = layui.$, active = {
			reload : function() {
				var idObj = $('#id');
				var keywordObj = $('#keyword');
				//执行重载
				table.reload('jtTableReload', {
					page : {
						curr : 1
					//重新从第 1 页开始
					},
					where : {
						date1 : $("#data1").val()
					}
				});
			},
			addData : function() {
				jtUtil.addRow(table, '登记课时',
						'#(ctx)/classRecord/toForm',1000,500);
			},
			getCheckData : function() { //获取选中数据
				layer.alert(JSON.stringify(jtUtil.getCheckData(table,
						'jtTableReload')));
			}
		};

		$('.jtSearch .layui-btn').on('click', function() {
			var type = $(this).data('type');
			active[type] ? active[type].call(this) : '';
		});

	});
</script>
#end
